language: java
install: true

env:
  DOCKER_USERNAME:
    secure: lWrILIgavyiAWmv7l5KNPW/GWODhxjn0+gCRRA3iU7+ZdW0y/tG3+96Lb9qPsbnie7ZJlj2i4dHUuWPRdHAKYMnWYLNaIaL9/UtrkwEUUPb+EXn21bx27hY3BZ1U6UdhO8PTp6q0Z4YOUPP86PH7esGkR8839jrkgkNZCF4tgSzoxXuLzTBMykks8CPJtDXDrYH/P6u+Kt9OREgyAGfVeUhptziHZAXVicNVRGopuZbSB2Rp016RSa0Pd69uOsCOPhJfuVfvYfdj/mnVN97eFpDCRK5FRiocS8uZ4+B8IVrzRjhmMzb4cINnd8UgBbTBMWNwApRzwYhRgoFo8kWhhjU2XIogPVo+H9I5UVJZqDJvHvfeQ0A+KbvFDvkjrnoGa/k6vtUWySRzGMUac4K9mzko1QqMYAbXEbRMJ4IJAm5SkeCupGND+GC6iXc22k/dJWGdWOohDE/s3Xx/B1rd6wSgHOeElS+Lr5770nQWBLkj4sdMYTtrkFOGOQNygF4nOz65rxAh4LLq7M8LtD5dsG9PDhpXWbFtnDOVclpOVr/OCQ5fZPf2Kvb9h2TQTj3WTP8B78bYfJnf2KqYl1HNQ5n+CHlvtexExOvxy7LoQSpK9OY0coJqmIHx6iXjptjCLWDvmPgA/p4tXdWqXMbp/sBgTykAO/G3MnI4Gu2nL+8=
  DOCKER_PASSWORD:
    secure: jcAFDmgmCXPt9fSJG/qXkY6TqS7AUxjeVRNSv1/Ydz0LVdnY3PNNV4+DgQ9b+s7tTB97vogWBmbiU2Hy+arAxIbwZ595jU/zHzn2AUl85LsZ13fb+emJ0OICxJoQ46F3W1XkZNSRw9Q9sBm1540U7y/hAN8c7trf41NZRsvmFBBr8XSf582P/SR3bYu50u/o+HTRcLVBKoOQLxr98UEuYNvkf1mxgXom+EUOOIM8tBh42l1J/KNDp16M3AorpZbN4zEipoHVUcMxNR+SzXNTjWdH5CGSDw96wklgW6X2M16T/U+KNVD2BkEss/ftVioNIbFqdm6HUqrzgiAZma8GbzBJfJycuUSsBbKUlfcPJ0Clg/tC12wleqYaCzr99+pXYnJi9UATz0ymacySTSJIRh60+x1g2Y7+cC+w/5OB9iLxTLsCqxWSLcTEKnHh0ZiwPSfFEOw7ipY8Q492HvwO2eUKl2r90v/qfiPntTPjUH3RP+fbCE2Sv58LnRMFPRXpgUq9nMebQunU4zst3TOISUxdw3eerwoCp9z13sBIZLxUbIvMXqbXKYs7m6ubVFAEwr4Kp7dcwNFyUh4AaoMiLmNlf20cpvbc65IIPhOei1B7g9zoviHqfPVTyi7lngXTMf1Vuq6du9OdyBgQeqltvPR0GrbxFXoZbIWRHGNWG/I=

jobs:
  include:
  - stage: build docker image
    script:
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - docker build -t gendercomics/api .
    - docker images
    - docker tag gendercomics/api $DOCKER_USERNAME/gendercomics-api
    - docker push $DOCKER_USERNAME/gendercomics-api

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
